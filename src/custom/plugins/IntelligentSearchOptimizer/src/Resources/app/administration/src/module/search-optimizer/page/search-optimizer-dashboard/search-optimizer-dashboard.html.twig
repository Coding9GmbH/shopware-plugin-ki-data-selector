{% block search_optimizer_dashboard %}
<sw-page class="search-optimizer-dashboard">
    {% block search_optimizer_dashboard_header %}
    <template #smart-bar-header>
        <h2>{{ $tc('search-optimizer.dashboard.title') }}</h2>
    </template>
    {% endblock %}

    {% block search_optimizer_dashboard_actions %}
    <template #smart-bar-actions>
        <sw-button variant="primary" @click="onRefresh">
            {{ $tc('global.default.refresh') }}
        </sw-button>
    </template>
    {% endblock %}

    {% block search_optimizer_dashboard_content %}
    <template #content>
        <sw-card-view>
            {% block search_optimizer_dashboard_filters %}
            <sw-card :title="$tc('search-optimizer.dashboard.filters')" :isLoading="isLoading">
                <sw-container columns="repeat(auto-fit, minmax(200px, 1fr))" gap="20px">
                    <sw-datepicker
                        :value="dateFrom"
                        :label="$tc('search-optimizer.dashboard.dateFrom')"
                        @input="dateFrom = $event; loadDashboardData()">
                    </sw-datepicker>
                    
                    <sw-datepicker
                        :value="dateTo"
                        :label="$tc('search-optimizer.dashboard.dateTo')"
                        @input="dateTo = $event; loadDashboardData()">
                    </sw-datepicker>
                    
                    <sw-entity-single-select
                        :value="selectedSalesChannelId"
                        entity="sales_channel"
                        :label="$tc('search-optimizer.dashboard.salesChannel')"
                        @input="selectedSalesChannelId = $event; loadDashboardData()">
                    </sw-entity-single-select>
                    
                    <sw-entity-single-select
                        :value="selectedLanguageId"
                        entity="language"
                        :label="$tc('search-optimizer.dashboard.language')"
                        @input="selectedLanguageId = $event; loadDashboardData()">
                    </sw-entity-single-select>
                </sw-container>
            </sw-card>
            {% endblock %}

            {% block search_optimizer_dashboard_summary %}
            <sw-card :title="$tc('search-optimizer.dashboard.summary.title')" :isLoading="isLoading" v-if="dashboardData">
                <sw-container columns="repeat(auto-fit, minmax(200px, 1fr))" gap="20px">
                    <sw-card-section divider="right">
                        <div class="search-optimizer-dashboard__stat">
                            <div class="search-optimizer-dashboard__stat-value">{{ dashboardData.summary.total_searches || 0 }}</div>
                            <div class="search-optimizer-dashboard__stat-label">{{ $tc('search-optimizer.dashboard.summary.totalSearches') }}</div>
                        </div>
                    </sw-card-section>
                    
                    <sw-card-section divider="right">
                        <div class="search-optimizer-dashboard__stat">
                            <div class="search-optimizer-dashboard__stat-value">{{ dashboardData.summary.unique_terms || 0 }}</div>
                            <div class="search-optimizer-dashboard__stat-label">{{ $tc('search-optimizer.dashboard.summary.uniqueTerms') }}</div>
                        </div>
                    </sw-card-section>
                    
                    <sw-card-section divider="right">
                        <div class="search-optimizer-dashboard__stat">
                            <div class="search-optimizer-dashboard__stat-value">{{ dashboardData.summary.zero_results || 0 }}</div>
                            <div class="search-optimizer-dashboard__stat-label">{{ $tc('search-optimizer.dashboard.summary.zeroResults') }}</div>
                        </div>
                    </sw-card-section>
                    
                    <sw-card-section>
                        <div class="search-optimizer-dashboard__stat">
                            <div class="search-optimizer-dashboard__stat-value">{{ dashboardData.summary.conversion_rate || 0 }}%</div>
                            <div class="search-optimizer-dashboard__stat-label">{{ $tc('search-optimizer.dashboard.summary.conversionRate') }}</div>
                        </div>
                    </sw-card-section>
                </sw-container>
            </sw-card>
            {% endblock %}

            {% block search_optimizer_dashboard_top_searches %}
            <sw-card :title="$tc('search-optimizer.dashboard.topSearches.title')" :isLoading="isLoading" v-if="dashboardData && dashboardData.topSearches">
                <sw-data-grid
                    :dataSource="dashboardData.topSearches"
                    :columns="topSearchColumns"
                    :showSelection="false"
                    :showActions="false">
                    
                    <template #column-search_term="{ item }">
                        <strong>{{ item.search_term }}</strong>
                    </template>
                    
                    <template #column-conversion_rate="{ item }">
                        <sw-color-badge :variant="getConversionVariant(item.conversion_rate)">
                            {{ item.conversion_rate }}%
                        </sw-color-badge>
                    </template>
                </sw-data-grid>
                
                <sw-button variant="ghost" size="small" @click="onExport('top')">
                    {{ $tc('search-optimizer.dashboard.export') }}
                </sw-button>
            </sw-card>
            {% endblock %}

            {% block search_optimizer_dashboard_zero_results %}
            <sw-card :title="$tc('search-optimizer.zeroResults.title')" :isLoading="isLoading" v-if="dashboardData && dashboardData.zeroResults">
                <sw-data-grid
                    :dataSource="dashboardData.zeroResults"
                    :columns="zeroResultColumns"
                    :showSelection="false"
                    :showActions="true">
                    
                    <template #column-search_term="{ item }">
                        <strong>{{ item.search_term }}</strong>
                    </template>
                    
                    <template #actions="{ item }">
                        <sw-context-menu-item @click="createSynonym(item)">
                            {{ $tc('search-optimizer.zeroResults.createSynonym') }}
                        </sw-context-menu-item>
                        <sw-context-menu-item @click="createRedirect(item)">
                            {{ $tc('search-optimizer.zeroResults.createRedirect') }}
                        </sw-context-menu-item>
                    </template>
                </sw-data-grid>
                
                <sw-button variant="ghost" size="small" @click="onExport('zero')">
                    {{ $tc('search-optimizer.dashboard.export') }}
                </sw-button>
            </sw-card>
            {% endblock %}
        </sw-card-view>
    </template>
    {% endblock %}
</sw-page>
{% endblock %}