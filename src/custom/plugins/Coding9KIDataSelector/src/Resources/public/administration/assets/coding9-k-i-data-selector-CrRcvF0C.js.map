{"version":3,"file":"coding9-k-i-data-selector-CrRcvF0C.js","sources":["../../../app/administration/src/module/kidata-selector/acl/index.js","../../../app/administration/src/module/kidata-selector/page/kidata-selector-index/kidata-selector-index.html.twig","../../../app/administration/src/core/version-helper.js","../../../app/administration/src/module/kidata-selector/page/kidata-selector-index/index.js","../../../app/administration/src/module/kidata-selector/page/kidata-selector-list/kidata-selector-list.html.twig","../../../app/administration/src/module/kidata-selector/page/kidata-selector-list/index.js","../../../app/administration/src/module/kidata-selector/page/kidata-selector-detail/kidata-selector-detail.html.twig","../../../app/administration/src/module/kidata-selector/page/kidata-selector-detail/index.js","../../../app/administration/src/module/kidata-selector/index.js"],"sourcesContent":["Shopware.Service('privileges').addPrivilegeMappingEntry({\n    category: 'permissions',\n    parent: null,\n    key: 'kidata_selector',\n    roles: {\n        viewer: {\n            privileges: [\n                'kidata_query_log:read',\n                'kidata_saved_query:read'\n            ],\n            dependencies: []\n        },\n        editor: {\n            privileges: [\n                'kidata_query_log:create',\n                'kidata_saved_query:create',\n                'kidata_saved_query:update'\n            ],\n            dependencies: [\n                'kidata_selector.viewer'\n            ]\n        },\n        deleter: {\n            privileges: [\n                'kidata_saved_query:delete'\n            ],\n            dependencies: [\n                'kidata_selector.editor'\n            ]\n        }\n    }\n});\n","{% block kidata_selector_index %}\n<sw-page class=\"kidata-selector-index\">\n    {% block kidata_selector_index_header %}\n    <template #smart-bar-header>\n        <h2>{{ $tc('kidata-selector.page.title') }}</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_index_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant=\"ghost\"\n            @click=\"goToSavedQueries\">\n            Gespeicherte Queries\n        </sw-button>\n\n        <sw-button\n            variant=\"primary\"\n            :disabled=\"isLoading\"\n            @click=\"generateSQL\">\n            {{ $tc('kidata-selector.page.generateButton') }}\n        </sw-button>\n\n        <sw-button\n            variant=\"ghost\"\n            :disabled=\"!hasSQL\"\n            @click=\"saveQuery\">\n            Query speichern\n        </sw-button>\n\n        <sw-button\n            variant=\"ghost\"\n            :disabled=\"!canExport\"\n            @click=\"exportCSV\">\n            {{ $tc('kidata-selector.page.exportButton') }}\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_index_content %}\n    <template #content>\n        <sw-card-view>\n            {% block kidata_selector_index_prompt_card %}\n            <sw-card :title=\"$tc('kidata-selector.page.promptLabel')\" :isLoading=\"isLoading\">\n                <sw-textarea-field\n                    v-model=\"prompt\"\n                    :placeholder=\"$tc('kidata-selector.page.promptPlaceholder')\"\n                    :disabled=\"isLoading\"\n                    rows=\"4\">\n                </sw-textarea-field>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_index_sql_card %}\n            <sw-card\n                v-if=\"hasSQL\"\n                :title=\"$tc('kidata-selector.page.sqlLabel')\"\n                :isLoading=\"isLoading\">\n                <sw-alert v-if=\"hasError\" variant=\"danger\" class=\"kidata-error\">\n                    <strong>‚ùå Fehler bei der Ausf√ºhrung:</strong>\n                    <p>{{ lastError }}</p>\n                    <sw-button\n                        size=\"small\"\n                        variant=\"primary\"\n                        @click=\"fixQueryWithError\">\n                        üîß Query mit KI korrigieren\n                    </sw-button>\n                </sw-alert>\n\n                <sw-alert variant=\"warning\" class=\"kidata-warning\">\n                    <strong>‚ö†Ô∏è Warnung:</strong> Bitte √ºberpr√ºfen Sie die generierte SQL-Abfrage sorgf√§ltig bevor Sie diese ausf√ºhren.\n                    Sie sind selbst verantwortlich f√ºr die Ausf√ºhrung dieser Query. Falsche Queries k√∂nnen zu Performance-Problemen f√ºhren.\n                </sw-alert>\n\n                <div class=\"kidata-sql-container\">\n                    <sw-textarea-field\n                        v-model=\"sql\"\n                        :disabled=\"true\"\n                        rows=\"8\"\n                        class=\"kidata-sql-field\">\n                    </sw-textarea-field>\n                    <div class=\"kidata-sql-actions\">\n                        <sw-button\n                            size=\"small\"\n                            @click=\"copySQLToClipboard\">\n                            Copy SQL\n                        </sw-button>\n                        <sw-button\n                            variant=\"primary\"\n                            size=\"small\"\n                            :disabled=\"!canExecute\"\n                            @click=\"confirmAndExecute\">\n                            Query ausf√ºhren\n                        </sw-button>\n                    </div>\n                </div>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_index_results_card %}\n            <sw-card\n                v-if=\"executed\"\n                :title=\"$tc('kidata-selector.page.resultsLabel')\"\n                :isLoading=\"isLoading\">\n                <template v-if=\"hasResults\">\n                    <div class=\"kidata-results-info\">\n                        <span>{{ $tc('kidata-selector.page.totalLabel') }}: {{ total }}</span>\n                        <span>{{ $tc('kidata-selector.page.pageLabel') }}: {{ page }} / {{ totalPages }}</span>\n                    </div>\n\n                    <sw-data-grid\n                        :dataSource=\"rows\"\n                        :columns=\"columns.map(col => ({ property: col, label: col }))\"\n                        :showSelection=\"false\"\n                        :showActions=\"false\"\n                        :isLoading=\"isLoading\">\n                    </sw-data-grid>\n\n                    <sw-pagination\n                        v-if=\"totalPages > 1\"\n                        :page=\"page\"\n                        :limit=\"limit\"\n                        :total=\"total\"\n                        :total-visible=\"7\"\n                        @page-change=\"changePage\">\n                    </sw-pagination>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state\n                        :title=\"$tc('kidata-selector.page.noResults')\">\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","/**\n * Version Helper for Shopware Administration\n *\n * Provides compatibility helpers for different Shopware versions\n */\n\nexport default class VersionHelper {\n    /**\n     * Get the auth token for API requests\n     * Works across Shopware 6.4 - 6.7\n     */\n    static getAuthToken() {\n        try {\n            // Try 6.5+ way first\n            if (Shopware.Context?.api?.authToken?.access) {\n                return Shopware.Context.api.authToken.access;\n            }\n\n            // Fallback for 6.4\n            if (Shopware.Context?.api?.authToken) {\n                return Shopware.Context.api.authToken;\n            }\n\n            // Another fallback\n            if (Shopware.State?.getters?.['context/token']) {\n                return Shopware.State.getters['context/token'];\n            }\n\n            throw new Error('Could not retrieve auth token');\n        } catch (error) {\n            console.error('Failed to get auth token:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Get API headers for fetch requests\n     * @returns {Object} Headers object\n     */\n    static getApiHeaders() {\n        return {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${this.getAuthToken()}`\n        };\n    }\n\n    /**\n     * Create an API service instance\n     * @param {string} name - Service name\n     * @returns {Object} Service instance\n     */\n    static getApiService(name) {\n        // 6.5+\n        if (Shopware.Service && typeof Shopware.Service === 'function') {\n            return Shopware.Service(name);\n        }\n\n        // 6.4\n        if (Shopware.Application?.getContainer) {\n            const container = Shopware.Application.getContainer('service');\n            return container.get(name);\n        }\n\n        throw new Error(`Could not get API service: ${name}`);\n    }\n\n    /**\n     * Get repository for an entity\n     * @param {string} entityName - Entity name\n     * @returns {Object} Repository\n     */\n    static getRepository(entityName) {\n        const repositoryFactory = Shopware.Service('repositoryFactory');\n        return repositoryFactory.create(entityName);\n    }\n\n    /**\n     * Get Shopware version\n     * @returns {string|null} Version string or null\n     */\n    static getShopwareVersion() {\n        try {\n            // Try different ways to get version\n            if (Shopware.Context?.app?.config?.version) {\n                return Shopware.Context.app.config.version;\n            }\n\n            if (Shopware.Application?.version) {\n                return Shopware.Application.version;\n            }\n\n            return null;\n        } catch (error) {\n            console.warn('Could not determine Shopware version:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Check if current version is >= target version\n     * @param {string} targetVersion - Version to compare (e.g., '6.5.0.0')\n     * @returns {boolean}\n     */\n    static isVersionGte(targetVersion) {\n        const currentVersion = this.getShopwareVersion();\n        if (!currentVersion) {\n            return false;\n        }\n\n        return this.compareVersions(currentVersion, targetVersion) >= 0;\n    }\n\n    /**\n     * Compare two version strings\n     * @param {string} v1 - First version\n     * @param {string} v2 - Second version\n     * @returns {number} -1, 0, or 1\n     */\n    static compareVersions(v1, v2) {\n        const parts1 = v1.split('.').map(Number);\n        const parts2 = v2.split('.').map(Number);\n\n        for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n            const part1 = parts1[i] || 0;\n            const part2 = parts2[i] || 0;\n\n            if (part1 > part2) return 1;\n            if (part1 < part2) return -1;\n        }\n\n        return 0;\n    }\n\n    /**\n     * Safe clipboard copy (handles different browser APIs)\n     * @param {string} text - Text to copy\n     * @returns {Promise<void>}\n     */\n    static async copyToClipboard(text) {\n        // Modern clipboard API\n        if (navigator.clipboard && navigator.clipboard.writeText) {\n            return navigator.clipboard.writeText(text);\n        }\n\n        // Fallback for older browsers\n        return new Promise((resolve, reject) => {\n            const textarea = document.createElement('textarea');\n            textarea.value = text;\n            textarea.style.position = 'fixed';\n            textarea.style.opacity = '0';\n            document.body.appendChild(textarea);\n            textarea.select();\n\n            try {\n                document.execCommand('copy');\n                document.body.removeChild(textarea);\n                resolve();\n            } catch (error) {\n                document.body.removeChild(textarea);\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * Create download from blob (version-safe)\n     * @param {Blob} blob - Blob to download\n     * @param {string} filename - Filename\n     */\n    static downloadBlob(blob, filename) {\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        a.style.display = 'none';\n        document.body.appendChild(a);\n        a.click();\n\n        // Cleanup\n        setTimeout(() => {\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n        }, 100);\n    }\n\n    /**\n     * Make API request with proper headers\n     * @param {string} url - API endpoint\n     * @param {Object} options - Fetch options\n     * @returns {Promise<Response>}\n     */\n    static async apiFetch(url, options = {}) {\n        const defaultOptions = {\n            headers: this.getApiHeaders(),\n            ...options\n        };\n\n        // Merge headers if provided\n        if (options.headers) {\n            defaultOptions.headers = {\n                ...defaultOptions.headers,\n                ...options.headers\n            };\n        }\n\n        return fetch(url, defaultOptions);\n    }\n\n    /**\n     * Make API POST request with JSON body\n     * @param {string} url - API endpoint\n     * @param {Object} data - Data to send\n     * @returns {Promise<any>} Parsed JSON response\n     */\n    static async apiPost(url, data) {\n        const response = await this.apiFetch(url, {\n            method: 'POST',\n            body: JSON.stringify(data)\n        });\n\n        if (!response.ok) {\n            throw new Error(`API request failed: ${response.statusText}`);\n        }\n\n        return response.json();\n    }\n}\n","import template from './kidata-selector-index.html.twig';\nimport './kidata-selector-index.scss';\nimport VersionHelper from '../../../../core/version-helper';\n\nconst { Component, Mixin } = Shopware;\nconst { Criteria } = Shopware.Data;\n\nComponent.register('kidata-selector-index', {\n    template,\n\n    inject: ['systemConfigApiService', 'repositoryFactory'],\n\n    mixins: [\n        Mixin.getByName('notification')\n    ],\n\n    data() {\n        return {\n            isLoading: false,\n            prompt: '',\n            originalPrompt: '', // Store original prompt for context\n            sql: '',\n            columns: [],\n            rows: [],\n            total: 0,\n            page: 1,\n            limit: 25,\n            totalPages: 0,\n            model: 'gpt-4o-mini',\n            executed: false,\n            lastError: null,\n            failedSql: null\n        };\n    },\n\n    computed: {\n        hasResults() {\n            return this.rows.length > 0;\n        },\n\n        hasSQL() {\n            return this.sql !== '';\n        },\n\n        canExecute() {\n            return !this.isLoading && this.hasSQL;\n        },\n\n        canExport() {\n            return !this.isLoading && this.hasResults;\n        },\n\n        hasError() {\n            return this.lastError !== null;\n        }\n    },\n\n    methods: {\n        async generateSQL() {\n            if (!this.prompt.trim()) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: 'Please enter a prompt'\n                });\n                return;\n            }\n\n            this.isLoading = true;\n            this.sql = '';\n            this.rows = [];\n            this.columns = [];\n            this.total = 0;\n            this.executed = false;\n\n            // Save original prompt for error correction context\n            this.originalPrompt = this.prompt;\n\n            try {\n                const response = await this.callApi({\n                    prompt: this.prompt,\n                    execute: false\n                });\n\n                if (response.success) {\n                    this.sql = response.sql;\n                    this.createNotificationSuccess({\n                        title: this.$tc('kidata-selector.page.successTitle'),\n                        message: 'SQL generated successfully'\n                    });\n                } else {\n                    this.createNotificationError({\n                        title: this.$tc('kidata-selector.page.errorTitle'),\n                        message: response.error || 'Failed to generate SQL'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        confirmAndExecute() {\n            // Show confirmation dialog\n            const confirmed = confirm(\n                'Sind Sie sicher, dass Sie diese SQL-Abfrage ausf√ºhren m√∂chten?\\n\\n' +\n                'Sie sind selbst verantwortlich f√ºr m√∂gliche Performance-Probleme oder fehlerhafte Ergebnisse.'\n            );\n\n            if (confirmed) {\n                this.executeQuery();\n            }\n        },\n\n        async executeQuery() {\n            if (!this.sql.trim()) {\n                await this.generateSQL();\n                if (!this.sql.trim()) {\n                    return;\n                }\n            }\n\n            this.isLoading = true;\n            this.lastError = null;\n            this.failedSql = null;\n\n            try {\n                const response = await this.callApi({\n                    sql: this.sql, // Send generated SQL instead of regenerating\n                    execute: true,\n                    page: this.page,\n                    limit: this.limit\n                });\n\n                if (response.success) {\n                    this.sql = response.sql;\n                    this.columns = response.columns || [];\n                    this.rows = response.rows || [];\n                    this.total = response.total || 0;\n                    this.page = response.page || 1;\n                    this.totalPages = response.totalPages || 0;\n                    this.executed = true;\n\n                    this.createNotificationSuccess({\n                        title: this.$tc('kidata-selector.page.successTitle'),\n                        message: `Found ${this.total} results`\n                    });\n                } else {\n                    // Store error for retry\n                    this.lastError = response.error || 'Query execution failed';\n                    this.failedSql = this.sql;\n\n                    this.createNotificationError({\n                        title: this.$tc('kidata-selector.page.errorTitle'),\n                        message: response.error || 'Query execution failed'\n                    });\n                }\n            } catch (error) {\n                // Store error for retry\n                this.lastError = error.message || 'An error occurred';\n                this.failedSql = this.sql;\n\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async changePage(params) {\n            // sw-pagination passes an object with { page, limit }\n            this.page = params.page || params;\n            if (params.limit) {\n                this.limit = params.limit;\n            }\n            await this.executeQuery();\n        },\n\n        async fixQueryWithError() {\n            if (!this.failedSql || !this.lastError) {\n                return;\n            }\n\n            this.isLoading = true;\n\n            try {\n                // Create error context prompt with original context\n                let errorPrompt = 'Der folgende SQL Query hat einen Fehler verursacht:\\n\\n';\n\n                // Include original prompt if available\n                if (this.originalPrompt) {\n                    errorPrompt += `Urspr√ºngliche Anfrage: ${this.originalPrompt}\\n\\n`;\n                }\n\n                errorPrompt += `Generierter SQL: ${this.failedSql}\\n\\n`;\n                errorPrompt += `Fehler: ${this.lastError}\\n\\n`;\n                errorPrompt += 'Bitte analysiere den Fehler und generiere einen korrigierten SQL Query.';\n\n                // Update prompt field with error context\n                this.prompt = errorPrompt;\n\n                const response = await this.callApi({\n                    prompt: errorPrompt,\n                    errorContext: {\n                        originalPrompt: this.originalPrompt,\n                        failedSql: this.failedSql,\n                        error: this.lastError\n                    },\n                    execute: false\n                });\n\n                if (response.success) {\n                    this.sql = response.sql;\n                    this.lastError = null;\n                    this.failedSql = null;\n\n                    this.createNotificationSuccess({\n                        title: this.$tc('kidata-selector.page.successTitle'),\n                        message: 'Query wurde korrigiert. Bitte pr√ºfen und erneut ausf√ºhren.'\n                    });\n                } else {\n                    this.createNotificationError({\n                        title: this.$tc('kidata-selector.page.errorTitle'),\n                        message: response.error || 'Fehlerkorrektur fehlgeschlagen'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async exportCSV() {\n            if (!this.sql.trim()) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: 'Please generate SQL first'\n                });\n                return;\n            }\n\n            this.isLoading = true;\n\n            try {\n                const response = await VersionHelper.apiFetch('/api/_action/kidata/export', {\n                    method: 'POST',\n                    body: JSON.stringify({\n                        sql: this.sql, // Send generated SQL instead of prompt\n                        delimiter: ';',\n                        enclosure: '\"'\n                    })\n                });\n\n                if (!response.ok) {\n                    throw new Error('Export failed');\n                }\n\n                const blob = await response.blob();\n                VersionHelper.downloadBlob(blob, `kidata-export-${Date.now()}.csv`);\n\n                this.createNotificationSuccess({\n                    title: this.$tc('kidata-selector.page.successTitle'),\n                    message: 'CSV exported successfully'\n                });\n            } catch (error) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: error.message || 'Export failed'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async callApi(payload) {\n            return await VersionHelper.apiPost('/api/_action/kidata/query', payload);\n        },\n\n        async copySQLToClipboard() {\n            if (!this.sql) return;\n\n            try {\n                await VersionHelper.copyToClipboard(this.sql);\n                this.createNotificationSuccess({\n                    title: this.$tc('kidata-selector.page.successTitle'),\n                    message: 'SQL copied to clipboard'\n                });\n            } catch (error) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: 'Failed to copy to clipboard'\n                });\n            }\n        },\n\n        async saveQuery() {\n            if (!this.sql) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: 'Kein SQL zum Speichern vorhanden'\n                });\n                return;\n            }\n\n            const name = prompt('Name f√ºr die Query:');\n            if (!name) {\n                return;\n            }\n\n            const description = prompt('Beschreibung (optional):');\n\n            this.isLoading = true;\n\n            try {\n                const data = await VersionHelper.apiPost('/api/_action/kidata/save', {\n                    name: name,\n                    description: description || '',\n                    sql: this.sql,\n                    prompt: this.prompt\n                });\n\n                if (data.success) {\n                    this.createNotificationSuccess({\n                        title: this.$tc('kidata-selector.page.successTitle'),\n                        message: 'Query wurde gespeichert'\n                    });\n                } else {\n                    this.createNotificationError({\n                        title: this.$tc('kidata-selector.page.errorTitle'),\n                        message: data.error || 'Fehler beim Speichern'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: this.$tc('kidata-selector.page.errorTitle'),\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        goToSavedQueries() {\n            this.$router.push({ name: 'kidata.selector.list' });\n        }\n    }\n});\n","{% block kidata_selector_list %}\n<sw-page class=\"kidata-selector-list\">\n    {% block kidata_selector_list_header %}\n    <template #smart-bar-header>\n        <h2>Gespeicherte Queries</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_list_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant=\"primary\"\n            @click=\"onCreateQuery\">\n            Neue Query erstellen\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_list_content %}\n    <template #content>\n        <sw-card-view>\n            <sw-card :isLoading=\"isLoading\">\n                <template v-if=\"hasQueries\">\n                    <sw-data-grid\n                        :dataSource=\"queries\"\n                        :columns=\"[\n                            { property: 'name', label: 'Name', primary: true },\n                            { property: 'description', label: 'Beschreibung' },\n                            { property: 'created_at', label: 'Erstellt am' }\n                        ]\"\n                        :showSelection=\"false\"\n                        :isLoading=\"isLoading\"\n                        @inline-edit-save=\"() => {}\">\n\n                        <template #actions=\"{ item }\">\n                            <sw-context-menu-item\n                                @click=\"onViewQuery(item.id)\">\n                                √ñffnen\n                            </sw-context-menu-item>\n                            <sw-context-menu-item\n                                variant=\"danger\"\n                                @click=\"deleteQuery(item.id)\">\n                                L√∂schen\n                            </sw-context-menu-item>\n                        </template>\n                    </sw-data-grid>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state\n                        v-if=\"!isLoading\"\n                        title=\"Keine gespeicherten Queries\"\n                        description=\"Erstellen Sie Ihre erste Query\">\n                        <template #actions>\n                            <sw-button\n                                variant=\"primary\"\n                                @click=\"onCreateQuery\">\n                                Neue Query erstellen\n                            </sw-button>\n                        </template>\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","import template from './kidata-selector-list.html.twig';\nimport './kidata-selector-list.scss';\nimport VersionHelper from '../../../../core/version-helper';\n\nconst { Component, Mixin } = Shopware;\n\nComponent.register('kidata-selector-list', {\n    template,\n\n    inject: ['repositoryFactory'],\n\n    mixins: [\n        Mixin.getByName('notification')\n    ],\n\n    data() {\n        return {\n            queries: [],\n            isLoading: false,\n            total: 0\n        };\n    },\n\n    computed: {\n        hasQueries() {\n            return this.queries.length > 0;\n        }\n    },\n\n    created() {\n        this.loadQueries();\n    },\n\n    methods: {\n        async loadQueries() {\n            this.isLoading = true;\n\n            try {\n                const response = await VersionHelper.apiFetch('/api/_action/kidata/saved', {\n                    method: 'GET'\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    this.queries = data.queries || [];\n                    this.total = this.queries.length;\n                } else {\n                    this.createNotificationError({\n                        title: 'Fehler',\n                        message: data.error || 'Fehler beim Laden der gespeicherten Queries'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async deleteQuery(id) {\n            const confirmed = confirm('M√∂chten Sie diese Query wirklich l√∂schen?');\n\n            if (!confirmed) {\n                return;\n            }\n\n            try {\n                const response = await VersionHelper.apiFetch(`/api/_action/kidata/saved/${id}`, {\n                    method: 'DELETE'\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    this.createNotificationSuccess({\n                        title: 'Erfolg',\n                        message: 'Query wurde gel√∂scht'\n                    });\n                    this.loadQueries();\n                } else {\n                    this.createNotificationError({\n                        title: 'Fehler',\n                        message: data.error || 'Fehler beim L√∂schen'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: error.message || 'An error occurred'\n                });\n            }\n        },\n\n        onCreateQuery() {\n            this.$router.push({ name: 'kidata.selector.index' });\n        },\n\n        onViewQuery(id) {\n            this.$router.push({ name: 'kidata.selector.detail', params: { id } });\n        }\n    }\n});\n","{% block kidata_selector_detail %}\n<sw-page class=\"kidata-selector-detail\">\n    {% block kidata_selector_detail_header %}\n    <template #smart-bar-header>\n        <h2>{{ queryName }}</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_detail_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant=\"ghost\"\n            @click=\"goBackToList\">\n            Zur√ºck zur Liste\n        </sw-button>\n\n        <sw-button\n            variant=\"ghost\"\n            :disabled=\"!canExport\"\n            @click=\"exportCSV\">\n            CSV Export\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_detail_content %}\n    <template #content>\n        <sw-card-view>\n            {% block kidata_selector_detail_info_card %}\n            <sw-card title=\"Query Information\" :isLoading=\"isLoading\">\n                <p><strong>Name:</strong> {{ queryName }}</p>\n                <p v-if=\"queryDescription\"><strong>Beschreibung:</strong> {{ queryDescription }}</p>\n                <p v-if=\"originalPrompt\"><strong>Original Prompt:</strong> {{ originalPrompt }}</p>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_detail_sql_card %}\n            <sw-card title=\"SQL Query\" :isLoading=\"isLoading\">\n                <div class=\"kidata-sql-container\">\n                    <sw-textarea-field\n                        v-model=\"sql\"\n                        :disabled=\"true\"\n                        rows=\"8\"\n                        class=\"kidata-sql-field\">\n                    </sw-textarea-field>\n                    <div class=\"kidata-sql-actions\">\n                        <sw-button\n                            size=\"small\"\n                            @click=\"copySQLToClipboard\">\n                            Copy SQL\n                        </sw-button>\n                        <sw-button\n                            variant=\"primary\"\n                            size=\"small\"\n                            :disabled=\"!canExecute\"\n                            @click=\"confirmAndExecute\">\n                            Query ausf√ºhren\n                        </sw-button>\n                    </div>\n                </div>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_detail_results_card %}\n            <sw-card\n                v-if=\"executed\"\n                title=\"Ergebnisse\"\n                :isLoading=\"isLoading\">\n                <template v-if=\"hasResults\">\n                    <div class=\"kidata-results-info\">\n                        <span>Total: {{ total }}</span>\n                        <span>Page: {{ page }} / {{ totalPages }}</span>\n                    </div>\n\n                    <sw-data-grid\n                        :dataSource=\"rows\"\n                        :columns=\"columns.map(col => ({ property: col, label: col }))\"\n                        :showSelection=\"false\"\n                        :showActions=\"false\"\n                        :isLoading=\"isLoading\">\n                    </sw-data-grid>\n\n                    <sw-pagination\n                        v-if=\"totalPages > 1\"\n                        :page=\"page\"\n                        :limit=\"limit\"\n                        :total=\"total\"\n                        :total-visible=\"7\"\n                        @page-change=\"changePage\">\n                    </sw-pagination>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state title=\"Keine Ergebnisse\">\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","import template from './kidata-selector-detail.html.twig';\nimport './kidata-selector-detail.scss';\nimport VersionHelper from '../../../../core/version-helper';\n\nconst { Component, Mixin } = Shopware;\n\nComponent.register('kidata-selector-detail', {\n    template,\n\n    inject: ['repositoryFactory'],\n\n    mixins: [\n        Mixin.getByName('notification')\n    ],\n\n    data() {\n        return {\n            isLoading: false,\n            queryId: null,\n            queryName: '',\n            queryDescription: '',\n            sql: '',\n            originalPrompt: '',\n            columns: [],\n            rows: [],\n            total: 0,\n            page: 1,\n            limit: 25,\n            totalPages: 0,\n            executed: false\n        };\n    },\n\n    computed: {\n        hasResults() {\n            return this.rows.length > 0;\n        },\n\n        canExecute() {\n            return !this.isLoading && this.sql !== '';\n        },\n\n        canExport() {\n            return !this.isLoading && this.hasResults;\n        }\n    },\n\n    created() {\n        this.queryId = this.$route.params.id;\n        this.loadQuery();\n    },\n\n    methods: {\n        async loadQuery() {\n            this.isLoading = true;\n\n            try {\n                const response = await VersionHelper.apiFetch(`/api/_action/kidata/saved/${this.queryId}`, {\n                    method: 'GET'\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    const query = data.query;\n                    this.queryName = query.name;\n                    this.queryDescription = query.description || '';\n                    this.sql = query.sql_query;\n                    this.originalPrompt = query.original_prompt || '';\n                } else {\n                    this.createNotificationError({\n                        title: 'Fehler',\n                        message: data.error || 'Query nicht gefunden'\n                    });\n                    this.$router.push({ name: 'kidata.selector.list' });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        confirmAndExecute() {\n            const confirmed = confirm(\n                'Sind Sie sicher, dass Sie diese SQL-Abfrage ausf√ºhren m√∂chten?\\n\\n' +\n                'Sie sind selbst verantwortlich f√ºr m√∂gliche Performance-Probleme oder fehlerhafte Ergebnisse.'\n            );\n\n            if (confirmed) {\n                this.executeQuery();\n            }\n        },\n\n        async executeQuery() {\n            this.isLoading = true;\n\n            try {\n                const response = await this.callApi({\n                    sql: this.sql,\n                    execute: true,\n                    page: this.page,\n                    limit: this.limit\n                });\n\n                if (response.success) {\n                    this.columns = response.columns || [];\n                    this.rows = response.rows || [];\n                    this.total = response.total || 0;\n                    this.page = response.page || 1;\n                    this.totalPages = response.totalPages || 0;\n                    this.executed = true;\n\n                    this.createNotificationSuccess({\n                        title: 'Erfolg',\n                        message: `${this.total} Ergebnisse gefunden`\n                    });\n                } else {\n                    this.createNotificationError({\n                        title: 'Fehler',\n                        message: response.error || 'Query execution failed'\n                    });\n                }\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: error.message || 'An error occurred'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async changePage(params) {\n            this.page = params.page || params;\n            if (params.limit) {\n                this.limit = params.limit;\n            }\n            await this.executeQuery();\n        },\n\n        async exportCSV() {\n            if (!this.sql.trim()) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: 'Please generate SQL first'\n                });\n                return;\n            }\n\n            this.isLoading = true;\n\n            try {\n                const response = await VersionHelper.apiFetch('/api/_action/kidata/export', {\n                    method: 'POST',\n                    body: JSON.stringify({\n                        sql: this.sql,\n                        delimiter: ';',\n                        enclosure: '\"'\n                    })\n                });\n\n                if (!response.ok) {\n                    throw new Error('Export failed');\n                }\n\n                const blob = await response.blob();\n                const filename = `${this.queryName.replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}.csv`;\n                VersionHelper.downloadBlob(blob, filename);\n\n                this.createNotificationSuccess({\n                    title: 'Erfolg',\n                    message: 'CSV exported successfully'\n                });\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: error.message || 'Export failed'\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async callApi(payload) {\n            return await VersionHelper.apiPost('/api/_action/kidata/query', payload);\n        },\n\n        async copySQLToClipboard() {\n            if (!this.sql) return;\n\n            try {\n                await VersionHelper.copyToClipboard(this.sql);\n                this.createNotificationSuccess({\n                    title: 'Erfolg',\n                    message: 'SQL copied to clipboard'\n                });\n            } catch (error) {\n                this.createNotificationError({\n                    title: 'Fehler',\n                    message: 'Failed to copy to clipboard'\n                });\n            }\n        },\n\n        goBackToList() {\n            this.$router.push({ name: 'kidata.selector.list' });\n        }\n    }\n});\n","import './acl';\nimport './page/kidata-selector-index';\nimport './page/kidata-selector-list';\nimport './page/kidata-selector-detail';\nimport VersionHelper from '../../core/version-helper';\n\nconst { Module } = Shopware;\n\nModule.register('kidata-selector', {\n    type: 'plugin',\n    name: 'KI Data Selector',\n    title: 'kidata-selector.general.mainMenuItemGeneral',\n    description: 'kidata-selector.general.descriptionTextModule',\n    color: '#ff3d58',\n    icon: 'regular-database',\n\n    snippets: {\n        'de-DE': {\n            'kidata-selector': {\n                general: {\n                    mainMenuItemGeneral: 'KI Data Selector',\n                    descriptionTextModule: 'AI-gest√ºtzter SQL-Query-Generator'\n                },\n                page: {\n                    title: 'KI Data Selector',\n                    promptLabel: 'Ihre Frage',\n                    promptPlaceholder: 'z.B. \"Gib mir alle Bestellungen der letzten Woche\"',\n                    modelLabel: 'OpenAI Modell',\n                    generateButton: 'SQL generieren',\n                    executeButton: 'Ausf√ºhren',\n                    exportButton: 'Als CSV exportieren',\n                    sqlLabel: 'Generierter SQL-Query',\n                    resultsLabel: 'Ergebnisse',\n                    totalLabel: 'Gesamt',\n                    pageLabel: 'Seite',\n                    limitLabel: 'Pro Seite',\n                    errorTitle: 'Fehler',\n                    successTitle: 'Erfolg',\n                    noResults: 'Keine Ergebnisse gefunden',\n                    loading: 'L√§dt...'\n                }\n            }\n        },\n        'en-GB': {\n            'kidata-selector': {\n                general: {\n                    mainMenuItemGeneral: 'KI Data Selector',\n                    descriptionTextModule: 'AI-powered SQL query generator'\n                },\n                page: {\n                    title: 'KI Data Selector',\n                    promptLabel: 'Your question',\n                    promptPlaceholder: 'e.g. \"Give me all orders from last week\"',\n                    modelLabel: 'OpenAI Model',\n                    generateButton: 'Generate SQL',\n                    executeButton: 'Execute',\n                    exportButton: 'Export as CSV',\n                    sqlLabel: 'Generated SQL Query',\n                    resultsLabel: 'Results',\n                    totalLabel: 'Total',\n                    pageLabel: 'Page',\n                    limitLabel: 'Per page',\n                    errorTitle: 'Error',\n                    successTitle: 'Success',\n                    noResults: 'No results found',\n                    loading: 'Loading...'\n                }\n            }\n        }\n    },\n\n    routes: {\n        index: {\n            component: 'kidata-selector-index',\n            path: 'index',\n            meta: {\n                privilege: 'kidata_selector.viewer'\n            }\n        },\n        list: {\n            component: 'kidata-selector-list',\n            path: 'list',\n            meta: {\n                privilege: 'kidata_selector.viewer'\n            }\n        },\n        detail: {\n            component: 'kidata-selector-detail',\n            path: 'detail/:id',\n            meta: {\n                privilege: 'kidata_selector.viewer'\n            }\n        }\n    },\n\n    navigation: (function() {\n        // Check if we're on 6.7+ or if sw-catalogue exists\n        const is67Plus = VersionHelper.isVersionGte('6.7.0.0');\n        const hasCatalogueMenu = Shopware.Module &&\n                                Shopware.Module.getModuleRegistry &&\n                                Shopware.Module.getModuleRegistry().get('sw-catalogue');\n\n        // Create navigation entries for different scenarios\n        const navigationEntries = [];\n\n        // Primary entry: Try sw-catalogue parent (for 6.4-6.6)\n        navigationEntries.push({\n            id: 'kidata-selector',\n            label: 'kidata-selector.general.mainMenuItemGeneral',\n            color: '#ff3d58',\n            icon: 'regular-database',\n            path: 'kidata.selector.index',\n            position: 100,\n            parent: 'sw-catalogue',\n            privilege: 'kidata_selector.viewer'\n        });\n\n        // Fallback entry: Top-level (for 6.7+ if catalogue doesn't exist)\n        if (is67Plus || !hasCatalogueMenu) {\n            navigationEntries.push({\n                id: 'kidata-selector-main',\n                label: 'kidata-selector.general.mainMenuItemGeneral',\n                color: '#ff3d58',\n                icon: 'regular-database',\n                path: 'kidata.selector.index',\n                position: 100,\n                parent: null, // Top-level\n                privilege: 'kidata_selector.viewer'\n            });\n        }\n\n        return navigationEntries;\n    })(),\n\n    // Add settingsItem for visibility in Settings menu (works in all versions)\n    settingsItem: [{\n        group: 'plugins',\n        to: 'kidata.selector.index',\n        icon: 'regular-database',\n        label: 'kidata-selector.general.mainMenuItemGeneral',\n        privilege: 'kidata_selector.viewer'\n    }]\n});\n\n// Additional registration: Try to add menu entry via MainMenuService (6.7+)\n// This is a fallback to ensure menu appears even if Module.register doesn't work properly\ntry {\n    if (Shopware.Service && typeof Shopware.Service === 'function') {\n        const mainMenuService = Shopware.Service('mainMenuService');\n        if (mainMenuService && typeof mainMenuService.addMenuItem === 'function') {\n            // 6.7+ approach: Register via MainMenuService\n            mainMenuService.addMenuItem({\n                id: 'kidata-selector-service',\n                label: 'kidata-selector.general.mainMenuItemGeneral',\n                color: '#ff3d58',\n                icon: 'regular-database',\n                path: 'kidata.selector.index',\n                position: 100,\n                privilege: 'kidata_selector.viewer'\n            });\n        }\n    }\n} catch (error) {\n    // Service might not exist in older versions, silently ignore\n    console.debug('MainMenuService not available, using classic navigation registration');\n}\n"],"names":["template$2","VersionHelper","_a","_b","_c","_d","_e","_f","_g","error","name","entityName","targetVersion","currentVersion","v1","v2","parts1","parts2","i","part1","part2","text","resolve","reject","textarea","blob","filename","url","a","options","defaultOptions","data","response","Component","Mixin","Criteria","template","params","errorPrompt","payload","description","template$1","id","query","Module","is67Plus","hasCatalogueMenu","navigationEntries","mainMenuService"],"mappings":"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"}