/*! For license information please see coding9-k-i-data-selector.js.LICENSE.txt */
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=(window.__sw__.assetPath + '/bundles/coding9kidataselector/'),r(r.s="tZQe")}({"0rRY":function(e,t,r){var n=r("Vc9S");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("P8hj").default)("5e784b16",n,!0,{})},"FA/k":function(e,t,r){var n=r("am9C");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("P8hj").default)("0a134052",n,!0,{})},NMWP:function(e,t){Shopware.Service("privileges").addPrivilegeMappingEntry({category:"permissions",parent:null,key:"kidata_selector",roles:{viewer:{privileges:["kidata_query_log:read","kidata_saved_query:read"],dependencies:[]},editor:{privileges:["kidata_query_log:create","kidata_saved_query:create","kidata_saved_query:update"],dependencies:["kidata_selector.viewer"]},deleter:{privileges:["kidata_saved_query:delete"],dependencies:["kidata_selector.editor"]}}})},P8hj:function(e,t,r){"use strict";function n(e,t){for(var r=[],n={},o=0;o<t.length;o++){var a=t[o],i=a[0],s={id:e+":"+o,css:a[1],media:a[2],sourceMap:a[3]};n[i]?n[i].parts.push(s):r.push(n[i]={id:i,parts:[s]})}return r}r.r(t),r.d(t,"default",(function(){return h}));var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var a={},i=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,l=!1,u=function(){},d=null,p="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(e,t,r,o){l=r,d=o||{};var i=n(e,t);return g(i),function(t){for(var r=[],o=0;o<i.length;o++){var s=i[o];(c=a[s.id]).refs--,r.push(c)}t?g(i=n(e,t)):i=[];for(o=0;o<r.length;o++){var c;if(0===(c=r[o]).refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete a[c.id]}}}}function g(e){for(var t=0;t<e.length;t++){var r=e[t],n=a[r.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](r.parts[o]);for(;o<r.parts.length;o++)n.parts.push(v(r.parts[o]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{var i=[];for(o=0;o<r.parts.length;o++)i.push(v(r.parts[o]));a[r.id]={id:r.id,refs:1,parts:i}}}}function m(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function v(e){var t,r,n=document.querySelector("style["+p+'~="'+e.id+'"]');if(n){if(l)return u;n.parentNode.removeChild(n)}if(f){var o=c++;n=s||(s=m()),t=b.bind(null,n,o,!1),r=b.bind(null,n,o,!0)}else n=m(),t=x.bind(null,n),r=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else r()}}var y,w=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function b(e,t,r,n){var o=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=w(t,o);else{var a=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function x(e,t){var r=t.css,n=t.media,o=t.sourceMap;if(n&&e.setAttribute("media",n),d.ssrId&&e.setAttribute(p,t.id),o&&(r+="\n/*# sourceURL="+o.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}},Vc9S:function(e,t,r){},am9C:function(e,t,r){},l0aQ:function(e,t,r){},mwlB:function(e,t,r){var n=r("l0aQ");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r("P8hj").default)("210592f0",n,!0,{})},tZQe:function(e,t,r){"use strict";r.r(t);r("NMWP"),r("FA/k");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){o=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),s=new Q(n||[]);return a(i,"_invoke",{value:L(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var f={};function h(){}function g(){}function m(){}var v={};u(v,s,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(q([])));w&&w!==t&&r.call(w,s)&&(v=w);var b=m.prototype=h.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function o(a,i,s,c){var l=p(e[a],e,i);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==n(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,s,c)}),(function(e){o("throw",e,s,c)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return o("throw",e,s,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=p(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function q(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,a(b,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:g,configurable:!0}),g.displayName=u(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,l,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(k.prototype),u(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(d(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(b),u(b,l,"Generator"),u(b,s,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=q,Q.prototype={constructor:Q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:q(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function a(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function s(e){a(i,n,o,s,c,"next",e)}function c(e){a(i,n,o,s,c,"throw",e)}s(void 0)}))}}var s=Shopware,c=s.Component,l=s.Mixin;Shopware.Data.Criteria;c.register("kidata-selector-index",{template:'{% block kidata_selector_index %}\n<sw-page class="kidata-selector-index">\n    {% block kidata_selector_index_header %}\n    <template #smart-bar-header>\n        <h2>{{ $tc(\'kidata-selector.page.title\') }}</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_index_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant="ghost"\n            @click="goToSavedQueries">\n            Gespeicherte Queries\n        </sw-button>\n\n        <sw-button\n            variant="primary"\n            :disabled="isLoading"\n            @click="generateSQL">\n            {{ $tc(\'kidata-selector.page.generateButton\') }}\n        </sw-button>\n\n        <sw-button\n            variant="ghost"\n            :disabled="!hasSQL"\n            @click="saveQuery">\n            Query speichern\n        </sw-button>\n\n        <sw-button\n            variant="ghost"\n            :disabled="!canExport"\n            @click="exportCSV">\n            {{ $tc(\'kidata-selector.page.exportButton\') }}\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_index_content %}\n    <template #content>\n        <sw-card-view>\n            {% block kidata_selector_index_prompt_card %}\n            <sw-card :title="$tc(\'kidata-selector.page.promptLabel\')" :isLoading="isLoading">\n                <sw-textarea-field\n                    v-model="prompt"\n                    :placeholder="$tc(\'kidata-selector.page.promptPlaceholder\')"\n                    :disabled="isLoading"\n                    rows="4">\n                </sw-textarea-field>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_index_sql_card %}\n            <sw-card\n                v-if="hasSQL"\n                :title="$tc(\'kidata-selector.page.sqlLabel\')"\n                :isLoading="isLoading">\n                <sw-alert v-if="hasError" variant="danger" class="kidata-error">\n                    <strong>‚ùå Fehler bei der Ausf√ºhrung:</strong>\n                    <p>{{ lastError }}</p>\n                    <sw-button\n                        size="small"\n                        variant="primary"\n                        @click="fixQueryWithError">\n                        üîß Query mit KI korrigieren\n                    </sw-button>\n                </sw-alert>\n\n                <sw-alert variant="warning" class="kidata-warning">\n                    <strong>‚ö†Ô∏è Warnung:</strong> Bitte √ºberpr√ºfen Sie die generierte SQL-Abfrage sorgf√§ltig bevor Sie diese ausf√ºhren.\n                    Sie sind selbst verantwortlich f√ºr die Ausf√ºhrung dieser Query. Falsche Queries k√∂nnen zu Performance-Problemen f√ºhren.\n                </sw-alert>\n\n                <div class="kidata-sql-container">\n                    <sw-textarea-field\n                        v-model="sql"\n                        :disabled="true"\n                        rows="8"\n                        class="kidata-sql-field">\n                    </sw-textarea-field>\n                    <div class="kidata-sql-actions">\n                        <sw-button\n                            size="small"\n                            @click="copySQLToClipboard">\n                            Copy SQL\n                        </sw-button>\n                        <sw-button\n                            variant="primary"\n                            size="small"\n                            :disabled="!canExecute"\n                            @click="confirmAndExecute">\n                            Query ausf√ºhren\n                        </sw-button>\n                    </div>\n                </div>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_index_results_card %}\n            <sw-card\n                v-if="executed"\n                :title="$tc(\'kidata-selector.page.resultsLabel\')"\n                :isLoading="isLoading">\n                <template v-if="hasResults">\n                    <div class="kidata-results-info">\n                        <span>{{ $tc(\'kidata-selector.page.totalLabel\') }}: {{ total }}</span>\n                        <span>{{ $tc(\'kidata-selector.page.pageLabel\') }}: {{ page }} / {{ totalPages }}</span>\n                    </div>\n\n                    <sw-data-grid\n                        :dataSource="rows"\n                        :columns="columns.map(col => ({ property: col, label: col }))"\n                        :showSelection="false"\n                        :showActions="false"\n                        :isLoading="isLoading">\n                    </sw-data-grid>\n\n                    <sw-pagination\n                        v-if="totalPages > 1"\n                        :page="page"\n                        :limit="limit"\n                        :total="total"\n                        :total-visible="7"\n                        @page-change="changePage">\n                    </sw-pagination>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state\n                        :title="$tc(\'kidata-selector.page.noResults\')">\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["systemConfigApiService","repositoryFactory"],mixins:[l.getByName("notification")],data:function(){return{isLoading:!1,prompt:"",originalPrompt:"",sql:"",columns:[],rows:[],total:0,page:1,limit:25,totalPages:0,model:"gpt-4o-mini",executed:!1,lastError:null,failedSql:null}},computed:{hasResults:function(){return this.rows.length>0},hasSQL:function(){return""!==this.sql},canExecute:function(){return!this.isLoading&&this.hasSQL},canExport:function(){return!this.isLoading&&this.hasResults},hasError:function(){return null!==this.lastError}},methods:{generateSQL:function(){var e=this;return i(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.prompt.trim()){t.next=3;break}return e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:"Please enter a prompt"}),t.abrupt("return");case 3:return e.isLoading=!0,e.sql="",e.rows=[],e.columns=[],e.total=0,e.executed=!1,e.originalPrompt=e.prompt,t.prev=10,t.next=13,e.callApi({prompt:e.prompt,execute:!1});case 13:(r=t.sent).success?(e.sql=r.sql,e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"SQL generated successfully"})):e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:r.error||"Failed to generate SQL"}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(10),e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:t.t0.message||"An error occurred"});case 20:return t.prev=20,e.isLoading=!1,t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[10,17,20,23]])})))()},confirmAndExecute:function(){confirm("Sind Sie sicher, dass Sie diese SQL-Abfrage ausf√ºhren m√∂chten?\n\nSie sind selbst verantwortlich f√ºr m√∂gliche Performance-Probleme oder fehlerhafte Ergebnisse.")&&this.executeQuery()},executeQuery:function(){var e=this;return i(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sql.trim()){t.next=5;break}return t.next=3,e.generateSQL();case 3:if(e.sql.trim()){t.next=5;break}return t.abrupt("return");case 5:return e.isLoading=!0,e.lastError=null,e.failedSql=null,t.prev=8,t.next=11,e.callApi({sql:e.sql,execute:!0,page:e.page,limit:e.limit});case 11:(r=t.sent).success?(e.sql=r.sql,e.columns=r.columns||[],e.rows=r.rows||[],e.total=r.total||0,e.page=r.page||1,e.totalPages=r.totalPages||0,e.executed=!0,e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"Found ".concat(e.total," results")})):(e.lastError=r.error||"Query execution failed",e.failedSql=e.sql,e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:r.error||"Query execution failed"})),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(8),e.lastError=t.t0.message||"An error occurred",e.failedSql=e.sql,e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:t.t0.message||"An error occurred"});case 20:return t.prev=20,e.isLoading=!1,t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[8,15,20,23]])})))()},changePage:function(e){var t=this;return i(o().mark((function r(){return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.page=e.page||e,e.limit&&(t.limit=e.limit),r.next=4,t.executeQuery();case 4:case"end":return r.stop()}}),r)})))()},fixQueryWithError:function(){var e=this;return i(o().mark((function t(){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.failedSql&&e.lastError){t.next=2;break}return t.abrupt("return");case 2:return e.isLoading=!0,t.prev=3,r="Der folgende SQL Query hat einen Fehler verursacht:\n\n",e.originalPrompt&&(r+="Urspr√ºngliche Anfrage: ".concat(e.originalPrompt,"\n\n")),r+="Generierter SQL: ".concat(e.failedSql,"\n\n"),r+="Fehler: ".concat(e.lastError,"\n\n"),r+="Bitte analysiere den Fehler und generiere einen korrigierten SQL Query.",e.prompt=r,t.next=12,e.callApi({prompt:r,errorContext:{originalPrompt:e.originalPrompt,failedSql:e.failedSql,error:e.lastError},execute:!1});case 12:(n=t.sent).success?(e.sql=n.sql,e.lastError=null,e.failedSql=null,e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"Query wurde korrigiert. Bitte pr√ºfen und erneut ausf√ºhren."})):e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:n.error||"Fehlerkorrektur fehlgeschlagen"}),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(3),e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:t.t0.message||"An error occurred"});case 19:return t.prev=19,e.isLoading=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[3,16,19,22]])})))()},exportCSV:function(){var e=this;return i(o().mark((function t(){var r,n,a,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sql.trim()){t.next=3;break}return e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:"Please generate SQL first"}),t.abrupt("return");case 3:return e.isLoading=!0,t.prev=4,t.next=7,fetch("/api/_action/kidata/export",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)},body:JSON.stringify({sql:e.sql,delimiter:";",enclosure:'"'})});case 7:if((r=t.sent).ok){t.next=10;break}throw new Error("Export failed");case 10:return t.next=12,r.blob();case 12:n=t.sent,a=window.URL.createObjectURL(n),(i=document.createElement("a")).href=a,i.download="kidata-export-".concat(Date.now(),".csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a),e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"CSV exported successfully"}),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(4),e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:t.t0.message||"Export failed"});case 27:return t.prev=27,e.isLoading=!1,t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[4,24,27,30]])})))()},callApi:function(e){return i(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/_action/kidata/query",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)},body:JSON.stringify(e)});case 2:return r=t.sent,t.next=5,r.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()},copySQLToClipboard:function(){var e=this;this.sql&&navigator.clipboard.writeText(this.sql).then((function(){e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"SQL copied to clipboard"})}))},saveQuery:function(){var e=this;return i(o().mark((function t(){var r,n,a,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sql){t.next=3;break}return e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:"Kein SQL zum Speichern vorhanden"}),t.abrupt("return");case 3:if(r=prompt("Name f√ºr die Query:")){t.next=6;break}return t.abrupt("return");case 6:return n=prompt("Beschreibung (optional):"),e.isLoading=!0,t.prev=8,t.next=11,fetch("/api/_action/kidata/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)},body:JSON.stringify({name:r,description:n||"",sql:e.sql,prompt:e.prompt})});case 11:return a=t.sent,t.next=14,a.json();case 14:(i=t.sent).success?e.createNotificationSuccess({title:e.$tc("kidata-selector.page.successTitle"),message:"Query wurde gespeichert"}):e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:i.error||"Fehler beim Speichern"}),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(8),e.createNotificationError({title:e.$tc("kidata-selector.page.errorTitle"),message:t.t0.message||"An error occurred"});case 21:return t.prev=21,e.isLoading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[8,18,21,24]])})))()},goToSavedQueries:function(){this.$router.push({name:"kidata.selector.list"})}}});r("0rRY");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(){d=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),s=new Q(o||[]);return n(i,"_invoke",{value:L(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var f={};function h(){}function g(){}function m(){}var v={};c(v,a,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(q([])));w&&w!==t&&r.call(w,a)&&(v=w);var b=m.prototype=h.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function o(n,a,i,s){var c=p(e[n],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==u(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,i,s)}),(function(e){o("throw",e,i,s)})):t.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return o("throw",e,i,s)}))}s(c.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=p(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function q(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,n(b,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:g,configurable:!0}),g.displayName=c(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(k.prototype),c(k.prototype,i,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=q,Q.prototype={constructor:Q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:q(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function p(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){p(a,n,o,i,s,"next",e)}function s(e){p(a,n,o,i,s,"throw",e)}i(void 0)}))}}var h=Shopware,g=h.Component,m=h.Mixin;g.register("kidata-selector-list",{template:'{% block kidata_selector_list %}\n<sw-page class="kidata-selector-list">\n    {% block kidata_selector_list_header %}\n    <template #smart-bar-header>\n        <h2>Gespeicherte Queries</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_list_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant="primary"\n            @click="onCreateQuery">\n            Neue Query erstellen\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_list_content %}\n    <template #content>\n        <sw-card-view>\n            <sw-card :isLoading="isLoading">\n                <template v-if="hasQueries">\n                    <sw-data-grid\n                        :dataSource="queries"\n                        :columns="[\n                            { property: \'name\', label: \'Name\', primary: true },\n                            { property: \'description\', label: \'Beschreibung\' },\n                            { property: \'created_at\', label: \'Erstellt am\' }\n                        ]"\n                        :showSelection="false"\n                        :isLoading="isLoading"\n                        @inline-edit-save="() => {}">\n\n                        <template #actions="{ item }">\n                            <sw-context-menu-item\n                                @click="onViewQuery(item.id)">\n                                √ñffnen\n                            </sw-context-menu-item>\n                            <sw-context-menu-item\n                                variant="danger"\n                                @click="deleteQuery(item.id)">\n                                L√∂schen\n                            </sw-context-menu-item>\n                        </template>\n                    </sw-data-grid>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state\n                        v-if="!isLoading"\n                        title="Keine gespeicherten Queries"\n                        description="Erstellen Sie Ihre erste Query">\n                        <template #actions>\n                            <sw-button\n                                variant="primary"\n                                @click="onCreateQuery">\n                                Neue Query erstellen\n                            </sw-button>\n                        </template>\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[m.getByName("notification")],data:function(){return{queries:[],isLoading:!1,total:0}},computed:{hasQueries:function(){return this.queries.length>0}},created:function(){this.loadQueries()},methods:{loadQueries:function(){var e=this;return f(d().mark((function t(){var r,n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.prev=1,t.next=4,fetch("/api/_action/kidata/saved",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)}});case 4:return r=t.sent,t.next=7,r.json();case 7:(n=t.sent).success?(e.queries=n.queries||[],e.total=e.queries.length):e.createNotificationError({title:"Fehler",message:n.error||"Fehler beim Laden der gespeicherten Queries"}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.createNotificationError({title:"Fehler",message:t.t0.message||"An error occurred"});case 14:return t.prev=14,e.isLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})))()},deleteQuery:function(e){var t=this;return f(d().mark((function r(){var n,o;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(confirm("M√∂chten Sie diese Query wirklich l√∂schen?")){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,fetch("/api/_action/kidata/saved/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)}});case 6:return n=r.sent,r.next=9,n.json();case 9:(o=r.sent).success?(t.createNotificationSuccess({title:"Erfolg",message:"Query wurde gel√∂scht"}),t.loadQueries()):t.createNotificationError({title:"Fehler",message:o.error||"Fehler beim L√∂schen"}),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(3),t.createNotificationError({title:"Fehler",message:r.t0.message||"An error occurred"});case 16:case"end":return r.stop()}}),r,null,[[3,13]])})))()},onCreateQuery:function(){this.$router.push({name:"kidata.selector.index"})},onViewQuery:function(e){this.$router.push({name:"kidata.selector.detail",params:{id:e}})}}});r("mwlB");function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(){y=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var a=t&&t.prototype instanceof p?t:p,i=Object.create(a.prototype),s=new Q(o||[]);return n(i,"_invoke",{value:L(e,r,s)}),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function p(){}function f(){}function h(){}var g={};c(g,a,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(q([])));w&&w!==t&&r.call(w,a)&&(g=w);var b=h.prototype=p.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function o(n,a,i,s){var c=u(e[n],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==v(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){o("next",e,i,s)}),(function(e){o("throw",e,i,s)})):t.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return o("throw",e,i,s)}))}s(c.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=S(i,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=u(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function q(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}return f.prototype=h,n(b,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:f,configurable:!0}),f.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(k.prototype),c(k.prototype,i,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=q,Q.prototype={constructor:Q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:q(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function w(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function b(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){w(a,n,o,i,s,"next",e)}function s(e){w(a,n,o,i,s,"throw",e)}i(void 0)}))}}var x=Shopware,k=x.Component,L=x.Mixin;k.register("kidata-selector-detail",{template:'{% block kidata_selector_detail %}\n<sw-page class="kidata-selector-detail">\n    {% block kidata_selector_detail_header %}\n    <template #smart-bar-header>\n        <h2>{{ queryName }}</h2>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_detail_actions %}\n    <template #smart-bar-actions>\n        <sw-button\n            variant="ghost"\n            @click="goBackToList">\n            Zur√ºck zur Liste\n        </sw-button>\n\n        <sw-button\n            variant="ghost"\n            :disabled="!canExport"\n            @click="exportCSV">\n            CSV Export\n        </sw-button>\n    </template>\n    {% endblock %}\n\n    {% block kidata_selector_detail_content %}\n    <template #content>\n        <sw-card-view>\n            {% block kidata_selector_detail_info_card %}\n            <sw-card title="Query Information" :isLoading="isLoading">\n                <p><strong>Name:</strong> {{ queryName }}</p>\n                <p v-if="queryDescription"><strong>Beschreibung:</strong> {{ queryDescription }}</p>\n                <p v-if="originalPrompt"><strong>Original Prompt:</strong> {{ originalPrompt }}</p>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_detail_sql_card %}\n            <sw-card title="SQL Query" :isLoading="isLoading">\n                <div class="kidata-sql-container">\n                    <sw-textarea-field\n                        v-model="sql"\n                        :disabled="true"\n                        rows="8"\n                        class="kidata-sql-field">\n                    </sw-textarea-field>\n                    <div class="kidata-sql-actions">\n                        <sw-button\n                            size="small"\n                            @click="copySQLToClipboard">\n                            Copy SQL\n                        </sw-button>\n                        <sw-button\n                            variant="primary"\n                            size="small"\n                            :disabled="!canExecute"\n                            @click="confirmAndExecute">\n                            Query ausf√ºhren\n                        </sw-button>\n                    </div>\n                </div>\n            </sw-card>\n            {% endblock %}\n\n            {% block kidata_selector_detail_results_card %}\n            <sw-card\n                v-if="executed"\n                title="Ergebnisse"\n                :isLoading="isLoading">\n                <template v-if="hasResults">\n                    <div class="kidata-results-info">\n                        <span>Total: {{ total }}</span>\n                        <span>Page: {{ page }} / {{ totalPages }}</span>\n                    </div>\n\n                    <sw-data-grid\n                        :dataSource="rows"\n                        :columns="columns.map(col => ({ property: col, label: col }))"\n                        :showSelection="false"\n                        :showActions="false"\n                        :isLoading="isLoading">\n                    </sw-data-grid>\n\n                    <sw-pagination\n                        v-if="totalPages > 1"\n                        :page="page"\n                        :limit="limit"\n                        :total="total"\n                        :total-visible="7"\n                        @page-change="changePage">\n                    </sw-pagination>\n                </template>\n\n                <template v-else>\n                    <sw-empty-state title="Keine Ergebnisse">\n                    </sw-empty-state>\n                </template>\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[L.getByName("notification")],data:function(){return{isLoading:!1,queryId:null,queryName:"",queryDescription:"",sql:"",originalPrompt:"",columns:[],rows:[],total:0,page:1,limit:25,totalPages:0,executed:!1}},computed:{hasResults:function(){return this.rows.length>0},canExecute:function(){return!this.isLoading&&""!==this.sql},canExport:function(){return!this.isLoading&&this.hasResults}},created:function(){this.queryId=this.$route.params.id,this.loadQuery()},methods:{loadQuery:function(){var e=this;return b(y().mark((function t(){var r,n,o;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.prev=1,t.next=4,fetch("/api/_action/kidata/saved/".concat(e.queryId),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)}});case 4:return r=t.sent,t.next=7,r.json();case 7:(n=t.sent).success?(o=n.query,e.queryName=o.name,e.queryDescription=o.description||"",e.sql=o.sql_query,e.originalPrompt=o.original_prompt||""):(e.createNotificationError({title:"Fehler",message:n.error||"Query nicht gefunden"}),e.$router.push({name:"kidata.selector.list"})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.createNotificationError({title:"Fehler",message:t.t0.message||"An error occurred"});case 14:return t.prev=14,e.isLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})))()},confirmAndExecute:function(){confirm("Sind Sie sicher, dass Sie diese SQL-Abfrage ausf√ºhren m√∂chten?\n\nSie sind selbst verantwortlich f√ºr m√∂gliche Performance-Probleme oder fehlerhafte Ergebnisse.")&&this.executeQuery()},executeQuery:function(){var e=this;return b(y().mark((function t(){var r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.prev=1,t.next=4,e.callApi({sql:e.sql,execute:!0,page:e.page,limit:e.limit});case 4:(r=t.sent).success?(e.columns=r.columns||[],e.rows=r.rows||[],e.total=r.total||0,e.page=r.page||1,e.totalPages=r.totalPages||0,e.executed=!0,e.createNotificationSuccess({title:"Erfolg",message:"".concat(e.total," Ergebnisse gefunden")})):e.createNotificationError({title:"Fehler",message:r.error||"Query execution failed"}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e.createNotificationError({title:"Fehler",message:t.t0.message||"An error occurred"});case 11:return t.prev=11,e.isLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},changePage:function(e){var t=this;return b(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.page=e.page||e,e.limit&&(t.limit=e.limit),r.next=4,t.executeQuery();case 4:case"end":return r.stop()}}),r)})))()},exportCSV:function(){var e=this;return b(y().mark((function t(){var r,n,o,a;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sql.trim()){t.next=3;break}return e.createNotificationError({title:"Fehler",message:"Please generate SQL first"}),t.abrupt("return");case 3:return e.isLoading=!0,t.prev=4,t.next=7,fetch("/api/_action/kidata/export",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)},body:JSON.stringify({sql:e.sql,delimiter:";",enclosure:'"'})});case 7:if((r=t.sent).ok){t.next=10;break}throw new Error("Export failed");case 10:return t.next=12,r.blob();case 12:n=t.sent,o=window.URL.createObjectURL(n),(a=document.createElement("a")).href=o,a.download="".concat(e.queryName.replace(/[^a-zA-Z0-9]/g,"_"),"_").concat(Date.now(),".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o),e.createNotificationSuccess({title:"Erfolg",message:"CSV exported successfully"}),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(4),e.createNotificationError({title:"Fehler",message:t.t0.message||"Export failed"});case 27:return t.prev=27,e.isLoading=!1,t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[4,24,27,30]])})))()},callApi:function(e){return b(y().mark((function t(){var r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/_action/kidata/query",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Shopware.Context.api.authToken.access)},body:JSON.stringify(e)});case 2:return r=t.sent,t.next=5,r.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()},copySQLToClipboard:function(){var e=this;this.sql&&navigator.clipboard.writeText(this.sql).then((function(){e.createNotificationSuccess({title:"Erfolg",message:"SQL copied to clipboard"})}))},goBackToList:function(){this.$router.push({name:"kidata.selector.list"})}}}),Shopware.Module.register("kidata-selector",{type:"plugin",name:"KI Data Selector",title:"kidata-selector.general.mainMenuItemGeneral",description:"kidata-selector.general.descriptionTextModule",color:"#ff3d58",icon:"regular-database",snippets:{"de-DE":{"kidata-selector":{general:{mainMenuItemGeneral:"KI Data Selector",descriptionTextModule:"AI-gest√ºtzter SQL-Query-Generator"},page:{title:"KI Data Selector",promptLabel:"Ihre Frage",promptPlaceholder:'z.B. "Gib mir alle Bestellungen der letzten Woche"',modelLabel:"OpenAI Modell",generateButton:"SQL generieren",executeButton:"Ausf√ºhren",exportButton:"Als CSV exportieren",sqlLabel:"Generierter SQL-Query",resultsLabel:"Ergebnisse",totalLabel:"Gesamt",pageLabel:"Seite",limitLabel:"Pro Seite",errorTitle:"Fehler",successTitle:"Erfolg",noResults:"Keine Ergebnisse gefunden",loading:"L√§dt..."}}},"en-GB":{"kidata-selector":{general:{mainMenuItemGeneral:"KI Data Selector",descriptionTextModule:"AI-powered SQL query generator"},page:{title:"KI Data Selector",promptLabel:"Your question",promptPlaceholder:'e.g. "Give me all orders from last week"',modelLabel:"OpenAI Model",generateButton:"Generate SQL",executeButton:"Execute",exportButton:"Export as CSV",sqlLabel:"Generated SQL Query",resultsLabel:"Results",totalLabel:"Total",pageLabel:"Page",limitLabel:"Per page",errorTitle:"Error",successTitle:"Success",noResults:"No results found",loading:"Loading..."}}}},routes:{index:{component:"kidata-selector-index",path:"index",meta:{privilege:"kidata_selector.viewer"}},list:{component:"kidata-selector-list",path:"list",meta:{privilege:"kidata_selector.viewer"}},detail:{component:"kidata-selector-detail",path:"detail/:id",meta:{privilege:"kidata_selector.viewer"}}},navigation:[{id:"kidata-selector",label:"kidata-selector.general.mainMenuItemGeneral",color:"#ff3d58",icon:"regular-database",path:"kidata.selector.index",position:100,parent:"sw-catalogue",privilege:"kidata_selector.viewer"}]})}});
//# sourceMappingURL=coding9-k-i-data-selector.js.map